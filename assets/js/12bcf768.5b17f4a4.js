"use strict";(self.webpackChunkWebaverse=self.webpackChunkWebaverse||[]).push([[4629],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),m=a,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return n?r.createElement(h,s(s({ref:t},p),{},{components:n})):r.createElement(h,s({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2591:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),s=["components"],i={id:"zjs-quickstart",title:"ZJS Quickstart"},l="Overview",c={unversionedId:"engineering/zjs/zjs-quickstart",id:"engineering/zjs/zjs-quickstart",title:"ZJS Quickstart",description:"zjs is a purpose-built API-compatible clone of yjs for multiplayer realtime games. Most of the concepts and documentation for yjs applies, so please read before attempting to work on the multiplayer.",source:"@site/docs/engineering/zjs/zjs-overview.md",sourceDirName:"engineering/zjs",slug:"/engineering/zjs/zjs-quickstart",permalink:"/doc/website/docs/engineering/zjs/zjs-quickstart",draft:!1,tags:[],version:"current",frontMatter:{id:"zjs-quickstart",title:"ZJS Quickstart"},sidebar:"tutorialSidebar",previous:{title:"WSRTC Quick Start",permalink:"/doc/website/docs/engineering/wsrtc/wsrtc-quickstart"},next:{title:"Matic Marketplace Instructions",permalink:"/doc/website/docs/market/matic-guide"}},p={},d=[{value:"Where Do I Start for Development?",id:"where-do-i-start-for-development",level:2},{value:"CRDTs",id:"crdts",level:4},{value:"zjs document hierarchy",id:"zjs-document-hierarchy",level:4}],u={toc:d};function m(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"overview"},"Overview"),(0,o.kt)("p",null,"zjs is a purpose-built API-compatible clone of yjs for multiplayer realtime games. Most of the concepts and documentation for yjs applies, so please read before attempting to work on the multiplayer."),(0,o.kt)("p",null,"The TL;DR is that zjs is a CRDT-backed document store. When changes to the Doc object occur, zjs will handle any conflicts and then send change events with the final state at that moment to all connected clients."),(0,o.kt)("p",null,'Any object in Webaverse which has a bound state -- players, app managers and tracked apps -- will be subscribed to these change events. This is done using the "observer" pattern, and zjs maps and arrays are observable objects.'),(0,o.kt)("h2",{id:"where-do-i-start-for-development"},"Where Do I Start for Development?"),(0,o.kt)("p",null,"If you are going to work on zjs you should start by reading through the tests. For any work you do, please write new tests and verify that they work."),(0,o.kt)("h4",{id:"crdts"},"CRDTs"),(0,o.kt)("p",null,"Webaverse is a peer-authoratative system. Objects in the world can be moved and manipulated by peers, and these changes will be reflected by the server out to other peers. It is simple in theory, but in practice this can potentially lead to conflicts where peers don't agree on where something is, or ",(0,o.kt)("em",{parentName:"p"},"what")," it is."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Conflict-free replicated data types")," or CRDTs are a set of data structures which can be merged in such a way that any inconsistencies are eventually resolved, and all peers will have the same document state. Additional reading can be found here:\n",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type"},"Conflict-free_replicated_data_type")),(0,o.kt)("h4",{id:"zjs-document-hierarchy"},"zjs document hierarchy"),(0,o.kt)("p",null,"Z.Doc"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"AppManager.appsArray -- all apps in the world"),(0,o.kt)("li",{parentName:"ul"},"PlayersManager.playersArray -- a list of all playerMap objects\n-- CharacterController.playerMap -- all the data synced about the player, including playerId, apps and transform\n-- CharacterController.avatarmap (getAvatarState) -- A map of avatar data ")),(0,o.kt)("p",null,"Here is an example of an app stored as a Z.Map"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "instanceId": "rum6g", // shared by all users\n    "contentId": "https://webaverse.github.io/silsword/",\n    "transform": [ -6, 0.5, 12, 0, 0, 0, 1, 1, 1, 1, 0 ],\n    "components": "[]"\n}\n')),(0,o.kt)("p",null,"Here is an example of a player stored as a Z.Map -- the player has an avatar and is holding a sword"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const examplePlayer = {\n    "playerId": "GoK3g",\n    "avatar": { "instanceId": "qgboft" },\n    "transform": {\n        "0": -1.3072199821472168, // position x\n        "1": 1.2576431035995483, // y\n        "2": 6.1084885597229, // z\n        "3": 0, // quaternion x\n        "4": 0.10555386543273926, // y\n        "5": 0, // z\n        "6": 0.9944136142730713, // w\n        "7": 16.66699981689453 // time delta\n    },\n    "actions": {\n        "e": [\n            {\n                "type": "wear",\n                "instanceId": "nxAup", // reference to the silsword user is holding\n                "actionId": "Hgos0"\n            }\n        ],\n        "i": [ "bafb82" ]\n    },\n    "apps": {\n        "e": [\n            { // avatar\n                "instanceId": "qgboft",\n                "contentId": "./avatars/scillia_drophunter_v15_vian.vrm",\n                "transform": {\n                    "0": 0, // position x\n                    "1": 0, // y\n                    "2": 0, // z\n                    "3": 0, // quaternion x\n                    "4": 0, // y\n                    "5": 0, // z\n                    "6": 1, // w\n                    "7": 1, // scale x\n                    "8": 1, // scale y\n                    "9": 1, // scale z\n                    "10": 0 // time delta\n                },\n                "components": "[]"\n            },\n            {\n                "instanceId": "nxAup",\n                "contentId": "https://webaverse.github.io/silsword/",\n                "transform": {\n                    "0": -0.9813549518585205, // position x\n                    "1": 1.536096215248108,  // y\n                    "2": 6.172163963317871, // z\n                    "3": 0.9454419016838074, // quaternion x\n                    "4": -0.30134329199790955, // y\n                    "5": -0.11808272451162338, // z\n                    "6": 0.037259675562381744, // w\n                    "7": 1, // scale x\n                    "8": 1, // scale y\n                    "9": 1, // scale z\n                    "10": 0 // time delta\n                },\n                "components": "[]"\n            }\n        ],\n        "i": [ "952bde", "808f75" ]\n    }\n}\n')))}m.isMDXComponent=!0}}]);