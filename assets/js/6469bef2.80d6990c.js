"use strict";(self.webpackChunkWebaverse=self.webpackChunkWebaverse||[]).push([[1026],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,d=c["".concat(s,".").concat(m)]||c[m]||f[m]||o;return n?r.createElement(d,i(i({ref:t},p),{},{components:n})):r.createElement(d,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4099:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>u,toc:()=>f});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={id:"graves-notes-unsorted",title:"Grave's Notes - Unsorted"},s="Web Audio Reverb Generation",u={unversionedId:"engineering/miscellaneous/graves-notes-unsorted",id:"engineering/miscellaneous/graves-notes-unsorted",title:"Grave's Notes - Unsorted",description:"Supporting Material",source:"@site/docs/engineering/miscellaneous/graves-notes-unsorted.md",sourceDirName:"engineering/miscellaneous",slug:"/engineering/miscellaneous/graves-notes-unsorted",permalink:"/engineering/miscellaneous/graves-notes-unsorted",draft:!1,tags:[],version:"current",frontMatter:{id:"graves-notes-unsorted",title:"Grave's Notes - Unsorted"},sidebar:"tutorialSidebar",previous:{title:"IPFS Backend Quick Start",permalink:"/engineering/ipfs/ipfs-backend-quickstart"},next:{title:"Multiplayer Overview",permalink:"/engineering/multiplayer/multiplayer-overview"}},p={},f=[{value:"Supporting Material",id:"supporting-material",level:2},{value:"Reverb Tail Generation",id:"reverb-tail-generation",level:2},{value:"Generating the tail",id:"generating-the-tail",level:3},{value:"Implementation",id:"implementation",level:2},{value:"L-system Theory",id:"l-system-theory",level:2}],c={toc:f};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"web-audio-reverb-generation"},"Web Audio Reverb Generation"),(0,o.kt)("h2",{id:"supporting-material"},"Supporting Material"),(0,o.kt)("p",null,"Article explaining convolution reverbs"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://blog.gskinner.com/archives/2019/02/reverb-web-audio-api.html"},"https://blog.gskinner.com/archives/2019/02/reverb-web-audio-api.html")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/mwmwmw/SimpleSound"},"https://github.com/mwmwmw/SimpleSound")," - supporting code"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://codepen.io/mwmwmw/pen/JxMdrM"},"https://codepen.io/mwmwmw/pen/JxMdrM")," - Advanced example"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://codepen.io/mwmwmw/pen/bzadEy"},"https://codepen.io/mwmwmw/pen/bzadEy")," - Simple example")),(0,o.kt)("h2",{id:"reverb-tail-generation"},"Reverb Tail Generation"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/CppIFEp.png",alt:null})),(0,o.kt)("p",null,"Use an easing function to create the falloff"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function easeInQuart(x: number): number {\nreturn x * x * x * x;\n}\n")),(0,o.kt)("p",null,"This should probably use the inverse square law, but is fine enough for getting setup."),(0,o.kt)("h3",{id:"generating-the-tail"},"Generating the tail"),(0,o.kt)("p",null,"lbuffer and rbuffer are parts of a buffer that will be set on the convolution nodes buffer. "),(0,o.kt)("p",null,"audioLength is the lenght of the reverb in seconds"),(0,o.kt)("p",null,"so the buffer size is the number of seconds * the sampling rate."),(0,o.kt)("p",null,"buffer size = 3 seconds * 48000hz = 144000 samples"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"const bufferSize = audioLength * audioContext.sampleRate\nfor(let i = 0; i < buffersize; i++) {\n    const ratio = (bufferSize - i) / bufferSize; // will be 1 at the start of the loop and 0 at the end\n    const fadeAmount = easeInQuart(ratio);\n    lBuffer[i] = (1-(2*Math.random())) * fadeAmount;\n    rBuffer[i] = (1-(2*Math.random())) * fadeAmount;\n  }\n\n")),(0,o.kt)("p",null,"The basic idea of this is to get the ratio of progress through the loop, and then use that value to apply the easing function to the generated noise so that the volume of the noise follows the easing curve (see the first diagram)"),(0,o.kt)("h2",{id:"implementation"},"Implementation"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"const {offset, duration} = audioSpec;\n  const audioContext = Avatar.getAudioContext();\n  const bufferSize = audioLength * audioContext.sampleRate;\n  let lBuffer = new Float32Array(bufferSize);\n  let rBuffer = new Float32Array(bufferSize);\n  for(let i = 0; i < bufferSize; i++) {\n    const ratio = (bufferSize - i) / bufferSize; // will be 1 at the start of the loop and 0 at the end\n    const fadeAmount = easeInQuart(ratio);\n    lBuffer[i] = (1-(2*Math.random())) * fadeAmount;\n    rBuffer[i] = (1-(2*Math.random())) * fadeAmount;\n  }\n  let buffer = audioContext.createBuffer(2, bufferSize, audioContext.sampleRate);\n  buffer.copyToChannel(lBuffer,0);\n  buffer.copyToChannel(rBuffer,1);\n\n  let convolver = audioContext.createConvolver();\n  convolver.buffer = buffer;\n  const audioBufferSourceNode = audioContext.createBufferSource();\n  audioBufferSourceNode.buffer = soundFileAudioBuffer;\n  audioBufferSourceNode.connect(convolver);\n  convolver.connect(audioContext.destination);\n  audioBufferSourceNode.start(0, offset, duration);\n  return audioBufferSourceNode;\n  \n")),(0,o.kt)("h1",{id:"systemsalgorithms"},"Systems/Algorithms"),(0,o.kt)("h2",{id:"l-system-theory"},"L-system Theory"),(0,o.kt)("p",null,"L-systems are used to effiently store and generate fractals like plants and crystal structures. This will be an effective way to generate plants for the game world. "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://algorithmicbotany.org/papers/abop/abop.pdf"},"The book on L-systems")),(0,o.kt)("li",{parentName:"ul"},"Extremely succinct and informative video by Danial Shiffman ",(0,o.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=f6ra024-ASY"},"https://www.youtube.com/watch?v=f6ra024-ASY")),(0,o.kt)("li",{parentName:"ul"},"Example code of a simple L system (D.Shiffman)",(0,o.kt)("br",{parentName:"li"}),(0,o.kt)("a",{parentName:"li",href:"https://github.com/nature-of-code/noc-examples-processing/blob/master/chp08_fractals/NOC_8_08_SimpleLSystem/NOC_8_08_SimpleLSystem.pde"},"https://github.com/nature-of-code/noc-examples-processing/blob/master/chp08_fractals/NOC_8_08_SimpleLSystem/NOC_8_08_SimpleLSystem.pde")),(0,o.kt)("li",{parentName:"ul"},"More complex version (D.Shiffman)\n",(0,o.kt)("a",{parentName:"li",href:"https://github.com/nature-of-code/noc-examples-processing/tree/master/chp08_fractals/NOC_8_09_LSystem"},"https://github.com/nature-of-code/noc-examples-processing/tree/master/chp08_fractals/NOC_8_09_LSystem"))))}m.isMDXComponent=!0}}]);